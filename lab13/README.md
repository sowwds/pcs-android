# Практическая 13 Ефремов Алексей ЭФБО-10-23

### **Цели работы:**
- Изучить возможности работы с аппаратными датчиками и сервисами мобильного устройства.
- Освоить получение координат устройства с помощью геолокации.
- Научиться определять местоположение, направление и движение.
- Изучить работу с сенсорами: акселерометр, гироскоп, компас.
- Разработать мобильное приложение, использующее геолокацию и данные сенсоров.

### **Ход работы:**

#### 1. Установка зависимостей
В `pubspec.yaml` были добавлены следующие зависимости:
- `geolocator`: для определения координат, скорости и статуса разрешений.
- `geocoding`: для преобразования координат в адрес.
- `sensors_plus`: для получения данных с акселерометра и гироскопа.
- `flutter_compass`: для получения данных о направлении с компаса.
- `permission_handler`: для запроса разрешений на использование геолокации.

#### 2. Настройка разрешений
- **Android (`AndroidManifest.xml`):** Были добавлены разрешения `ACCESS_FINE_LOCATION`, `ACCESS_COARSE_LOCATION`

#### 3. Ключевые моменты реализации
- **Архитектура:** Приложение состоит из одного главного экрана `StatefulWidget` `GeoSensorsPage`, который управляет состоянием всех данных от сенсоров и геолокации.
- **Получение данных:**
    - При инициализации экрана (`initState`) запрашиваются разрешения через `permission_handler`.
    - Создаются подписки (`StreamSubscription`) на потоки данных от `sensors_plus` (акселерометр, гироскоп) и `flutter_compass`. При поступлении новых данных состояние обновляется через `setState`.
    - При нажатии на кнопку "Определить местоположение" вызывается функция `_getLocation()`.
- **Работа с геолокацией:** Функция `_getLocation()` асинхронно выполняет следующие шаги:
    1.  Проверяет, включена ли служба геолокации на устройстве.
    2.  Запрашивает разрешение у пользователя, если оно не было предоставлено.
    3.  С помощью `Geolocator.getCurrentPosition()` получает текущие координаты.
    4.  С помощью `placemarkFromCoordinates()` из библиотеки `geocoding` получает адрес
    5.  Обновляет UI через `setState`, отображая полученные координаты и адрес.

#### 4. Видео работы



### **Ошибки и их решения**
- **Проблема:** При установке зависимостей возник конфликт версий. Версия пакета `sensors_plus` (`^4.0.3`), указанная в методичке, оказалась устаревшей.
- **Решение:** Проблема была решена путем обновления всех добавляемых пакетов (`geolocator`, `geocoding`, `sensors_plus`, `flutter_compass`, `permission_handler`) до их последних стабильных версий, найденных на `pub.dev`.

### **Ссылки на файлы**
*   [lib/main.dart](geo_sensors_app/lib/main.dart)
