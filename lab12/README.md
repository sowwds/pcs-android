# Практическая 12 Ефремов Алексей ЭФБО-10-23

### **Цели работы:**
- Изучить архитектуру и возможности аппаратной части мобильных устройств.
- Ознакомиться с API камеры и галереи во Flutter.
- Научиться создавать приложения, использующие камеру и хранилище устройства.
- Разобраться с разрешениями, обработкой изображений и сохранением данных.

### **Ход работы:**

#### 1. Установка зависимостей
В `pubspec.yaml`:
- `image_picker`: для выбора изображений из галереи и создания фотографий с помощью камеры.
- `permission_handler`: для запроса необходимых разрешений у пользователя (доступ к камере и галерее).
- `path_provider`: для получения пути к директории документов приложения, чтобы сохранять изображения.

#### 2. Настройка разрешений
- **Android (`AndroidManifest.xml`):**  разрешения `CAMERA`, `READ_EXTERNAL_STORAGE` и `WRITE_EXTERNAL_STORAGE`.

#### 3. Ключевые моменты реализации
- **Архитектура:** один экран `CameraPage` (`StatefulWidget`), который управляет состоянием выбранного изображения.
- **UI:** Просмотр изображения и три кнопки: "Сделать фото", "Выбрать из галереи" и "Сохранить фото".
- **Выбор изображения:** Функция `_getImage(ImageSource source)` запрашивает разрешения через `permission_handler`, а затем использует `image_picker` для получения изображения. Полученный файл (`XFile`) преобразуется в `File` и сохраняется в состоянии виджета через `setState`.
- **Сохранение изображения:** Функция `_saveImage()` асинхронно копирует выбранный файл изображения в папку документов приложения, используя `path_provider`. После сохранения выводится `SnackBar` с путем к новому файлу.

#### 4. Контрольные скриншоты

1.  **Интерфейс (главный экран):**
    *(место для скриншота)*

2.  **Камера в действии:**
    *(место для скриншота)*

3.  **Отображение выбранного фото:**
    *(место для скриншота)*

### **Ошибки и их решения**
`flutter analyze` нашел две проблемы:

1.  **Предупреждение `use_build_context_synchronously`**: Возникало при вызове `ScaffoldMessenger.of(context)` после сохранения файла.
    **Решение**: Перед вызовом `ScaffoldMessenger` проверка `if (!mounted)`

2.  **Ошибка в тесте `widget_test.dart`**: Тест падал, так как пытался найти виджет `MyApp`, который был заменен на `CameraApp`
    **Решение**: Фикс теста на проверку `CameraApp` на наличие заголовка и кнопок.

### **Ссылки на файлы**
*   [lib/main.dart](yefremov_camera_app/lib/main.dart)
