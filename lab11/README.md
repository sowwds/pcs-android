# Практическая 11 Ефремов Алексей ЭФБО-10-23

### **Цели работы:**
- Понять базовые понятия HTTP/REST: методы, URL/эндпоинты, коды ответов, заголовки, тела запросов/ответов (JSON).
- Освоить основы интеграции Flutter-приложения с внешним API: http/dio, сериализация JSON, обработка ошибок и таймаутов.
- Научиться выстраивать слой данных с репозиторием и отделять его от UI (продолжаем архитектурную линию прошлых ПЗ).
- Реализовать список сущностей из публичного API + экран деталей + форму создания/редактирования (с демонстрацией запросов).
- Разобраться с пагинацией, фильтрацией, аутентификацией (Bearer), ретраями и UX при сетевых сбоях.

### **Ход работы:**

#### 1. Подготовка проекта и добавление зависимостей

В `pubspec.yaml` была добавлена зависимость `dio` для выполнения HTTP-запросов к API.

#### 2. Структура проекта

*   `lib/models/note.dart`: Модель данных `Note` с полями `id`, `title`, `body`.
*   `lib/data/api_client.dart`: Класс `ApiClient` для работы с `dio`.
*   `lib/data/notes_repository.dart`: Использует `ApiClient` для выполнения запросов и дает UI  методы для работы с данными (`list`, `get`, `create`).
*   `lib/pages/notes_page.dart`: Это `StatefulWidget`, который управляет состоянием списка, пагинацией, обработкой загрузки и отображением данных, полученных из `NotesRepository`.
*   `lib/pages/note_details_page.dart`: Экран "подробнее" для одной записи

#### 3. Ключевые моменты реализации

*   **Слой данных**: Архитектура `UI -> Repository <-> ApiClient`. Логика работы с API отделена от UI.
*   **Пагинация**:  Бесконечная прокрутка, когда пользователь доходит до конца списка, вызываем метод `_loadMore()`, который подгружает следующу страницу с помощью `_page` и `_limit` в API.
*   **Обновление данных**: Свайп вниз, виджет `RefreshIndicator`, вызывает метод `_refresh`, сбрасывающий пагинацию и загружающий данные с первой страницы.
*   **Создание данных**: При нажатии на кнопку `+` (`FloatingActionButton`) открывается диалоговое окно (`AlertDialog`), где есть заголовок и текст. После сохранения отправляется POST-запрос (демо), и эта запись добавляется в начало списка.
*   **Обработка ошибок**: Сетевые ошибки и ошибки загрузки отлавливаются в `try-catch`. Уведомления через `SnackBar`.

#### 4. Контрольные скриншоты

1.  **Скриншот экрана списка:**
    *(место для скриншота)*

2.  **Скриншот экрана деталей:**
    *(место для скриншота)*

3.  **Скриншот диалога создания и результата (новый элемент в списке):**
    *(место для скриншота)*

### **Ошибки и их решения**

Ошибки с `setState() or markNeedsBuild() called during build` из-за того, что метод `_loadMore()`, вызывающий `setState()`, запускался в процессе отрисовки списка (`itemBuilder`).

**Решение**: Использование `Future.microtask()`.

### **Ссылки на файлы**
*   [lib/main.dart](yefremov_api_note_feed/lib/main.dart)
*   [lib/models/note.dart](yefremov_api_note_feed/lib/models/note.dart)
*   [lib/data/api_client.dart](yefremov_api_note_feed/lib/data/api_client.dart)
*   [lib/data/notes_repository.dart](yefremov_api_note_feed/lib/data/notes_repository.dart)
*   [lib/pages/notes_page.dart](yefremov_api_note_feed/lib/pages/notes_page.dart)
*   [lib/pages/note_details_page.dart](yefremov_api_note_feed/lib/pages/note_details_page.dart)
